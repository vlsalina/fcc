<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<style>

  svg {
    background-color: pink;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  #heading {
    position: absolute;
    top: 5%;
    left: 50%;
    transform: translate(-50%,0);
    text-align: center;
  }

  #title {
    color: blue;
  }

  #description {
    color: blue;
  }

</style>
</head>
<body>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script>

var margin = {"top": 50, "right": 50, "bottom": 50, "left": 50};
var width = 1080,
    height = 580;

// 8 colors
let colors = [

"#e5f5e0",
"#c7e9c0",
"#a1d99b",
"#74c476",
"#41ab5d",
"#238b45",
"#006d2c",
"#00441b"

];


var svg = d3.select("body").append("svg")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom);

var heading = d3.select("body")
          .append("div")
          .attr("id", "heading");

// title element
var title = heading.append("h1")
          .attr("id", "title")
          .html("United States Educational Attainment");

// description element
var description = heading.append("h3")
                  .attr("id", "description")
                  .html("Percentage of adults age 25 and older with a bachelor's degree or higher (2010-2014)");

var us = "https://cdn.freecodecamp.org/testable-projects-fcc/data/choropleth_map/counties.json";
var education = "https://cdn.freecodecamp.org/testable-projects-fcc/data/choropleth_map/for_user_education.json";

d3.queue()
  .defer(d3.json, us)
  .defer(d3.json, education)
  .await(ready);

var projection = d3.geoAlbersUsa()
                    .scale(100);

var path = d3.geoPath();
          //.projection(projection);

function ready(error, us, education) {
  if (error) throw error;
  
  var counties = topojson.feature(us, us.objects.counties).features;
  console.log(counties);
  console.log(education);

  //console.log(list);
  //console.log(typeof list[0][0]);
  //console.log(typeof us.objects.counties.geometries[0].id);

  // render map
  svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
    .selectAll(".county")
    .data(counties)
    .enter().append("path")
    .attr("class", "county")
    .attr("data-fips", function(d) { return d.id; }) 
    .attr("data-education", function(d) {
       let result = 0;
       for (let i = 0; i < education.length; i++) {
         if (education[i].fips == d.id) {
            result = education[i].bachelorsOrHigher; 
            break;
         }
       } 
       return result;
    })
    .attr("d", path);


  // color code counties by education attainment
  d3.selectAll(".county")
    .attr("fill", function(d) {
      //console.log(d3.select(this).attr("data-education"));
      let attainment =  d3.select(this).attr("data-education");

      if (attainment < 12) { return colors[0]; }
      else if (attainment < 21) { return colors[1]; }
      else if (attainment < 30) { return colors[2]; }
      else if (attainment < 39) { return colors[3]; }
      else if (attainment < 48) { return colors[4]; }
      else if (attainment < 57) { return colors[5]; }
      else if (attainment < 66) { return colors[6]; }
      else { return colors[7]; }
    });


};

</script>
</body>
</html>
